<% provide(:title, 'horeso index') %>

<%= content_for :side_menu do %>
  <%= render 'layouts/sidebar' %>
<% end %>

<div class="card ">
  <div class="card-header">
    <ul class="nav nav-tabs card-header-tabs pull-right"  id="myTab" role="tablist">
      <li class="nav-item">
      <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" target="_blank" rel="external nofollow"  role="tab" aria-controls="home" aria-selected="true">報告</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" target="_blank" rel="external nofollow"  role="tab" aria-controls="profile" aria-selected="false">連絡</a>
      </li>
      <li li class="nav-item">
        <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" target="_blank" rel="external nofollow"  role="tab" aria-controls="contact" aria-selected="false">相談</a>
      </li>
    </ul>
  </div>
  <div class="card-body">
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">

        <div class="box-report-index">
          <div class="box-report_search">
            <%= form_with url: "#", method: :get, local: true do |form| %>
              <%= form.hidden_field :search_type, :value => "report" %>
              <%= form.label :search, "件名検索：", class: "search-label" %>
              <%= form.text_field :search, placeholder: "キーワードを入力", class: "search-box" %>
              <%= form.submit "検索", class: "btn btn-outline-orange" %>
            <% end %>
          </div>

          <div class="table-header">
            <div class="subject-name">
              <%= @label_name %>
            </div>
            <div class="reported-date">
              報告日
            </div>
            <div class="report-confirmer">
              確認者
            </div>
            <div class="report-action">
              アクション
            </div>
          </div>

          <div class="table-body">
            <% if @reports.present? %>
              <% line_num = 0%>
              <% @reports.each do |report|%>
                <% line_num += 1%>
                <% subject = report.answers.find_by(question_id: @first_question.id).value %>
                <% if subject.blank? %>
                  <% subject = report.answers.find(@first_question).array_value %>
                <% end %>
                <div class="table-line", data-project-index-line-num="<%="#{line_num}"%>">
                  <div class="subject-name">
                    <%= link_to "#{subject}", "#", class: "report-detail-link" %>
                  </div>
                  <div class="reported-date">
                    <%= l(report.updated_at, format: :long) %>
                  </div>
                  <div class="report-confirmer">
                    <P> <% report.report_confirmers.where(report_confirmation_flag: true).count %> <span>人</span></p>
                  </div>
                  <div class="report-action">
                    <%= link_to "編集", "#", class: "btn btn-outline-orange" %>
                    <%= link_to "削除", "#", method: :delete, data: { confirm: "投稿された報告を削除してよろしいですか？" }, class: "btn btn-light btn-outline-secondary" %>
                  </div>
                </div>
              <% end %>
            <% end %>

            <% if @reports.blank?%>
              <P>投稿されている報告はありません。</P>
            <% end %>
          </div>

          <div class="index-paginate">
            <% if @reports.present?%>
              <div class="paginate">
                <%= paginate @reports %>
              </div>
            <% end %>

            <div class="back-btn">
              <%= link_to "戻る", :back, class: "btn btn-light btn-outline-secondary" %>
            </div>
          </div>
        </div>

      </div>
      <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
        Profile
      </div>
      <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
        Contact
      </div>
    </div>
  </div>
</div>

<!--プロジェクト新規登録、編集用モーダルウインドウ表示-->
<div id="project-new-edit" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="usereditModalLabel" aria-hidden="true" data-turbolinks="false"></div>
